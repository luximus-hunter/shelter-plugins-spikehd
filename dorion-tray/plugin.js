(()=>{var g=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var m=(n,e)=>{for(var s in e)g(n,s,{get:e[s],enumerable:!0})},p=(n,e,s,c)=>{if(e&&typeof e=="object"||typeof e=="function")for(let t of b(e))!E.call(n,t)&&t!==s&&g(n,t,{get:()=>e[t],enumerable:!(c=C(e,t))||c.enumerable});return n};var A=n=>p(g({},"__esModule",{value:!0}),n);var f=(n,e,s)=>new Promise((c,t)=>{var r=i=>{try{d(s.next(i))}catch(u){t(u)}},a=i=>{try{d(s.throw(i))}catch(u){t(u)}},d=i=>i.done?c(i.value):Promise.resolve(i.value).then(r,a);d((s=s.apply(n,e)).next())});var v={};m(v,{onUnload:()=>w});var{flux:{dispatcher:l}}=shelter,{invoke:h}=window.__TAURI__,o={connected:!1,muted:!1,deafened:!1,streaming:!1,video:!1,speaking:!1},T=n=>f(void 0,null,function*(){let{state:e}=n;e.toLowerCase()==="connected"||e.toLowerCase()==="connecting"?o.connected=!0:e.toLowerCase()==="disconnected"&&(o.connected=!1),yield _()}),I=n=>f(void 0,null,function*(){let e=localStorage.getItem("user_id_cache").replace(/"/g,""),s=n.voiceStates.find(d=>d.userId===e);if(!s)return;let{selfDeaf:c,selfMute:t,selfStream:r,selfVideo:a}=s;o.muted=t,o.deafened=c,o.streaming=r,o.video=a,yield _()}),S=n=>f(void 0,null,function*(){let e=localStorage.getItem("user_id_cache").replace(/"/g,""),{userId:s,speakingFlags:c}=n;s===e&&(o.speaking=c>0,yield _())}),_=()=>f(void 0,null,function*(){let{connected:n,muted:e,deafened:s,streaming:c,video:t,speaking:r}=o,a=null;if(!n)a="disconnected";else if(t)a="video";else if(c)a="streaming";else if(s)a="deafened";else if(e)a="muted";else if(r)a="speaking";else if(n)a="connected";else return;try{yield h("set_tray_icon",{event:a})}catch(d){}});l.subscribe("VOICE_STATE_UPDATES",I);l.subscribe("SPEAKING",S);l.subscribe("RTC_CONNECTION_STATE",T);var w=()=>{l.unsubscribe("VOICE_STATE_UPDATES",I),l.unsubscribe("SPEAKING",S),l.unsubscribe("RTC_CONNECTION_STATE",T)};return A(v);})();
